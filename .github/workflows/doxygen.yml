# ====================================================================
# GitHub Actions workflow: Build Doxygen docs and publish to GitHub Pages
# ====================================================================

name: Build-and-Deploy Doxygen

# ── Trigger ──────────────────────────────────────────────────────────
on:
  push:
    branches: [ main ]     # rebuild docs on every push to main
  workflow_dispatch:       # enable manual "Run workflow" button

# ── Single job: build docs, then deploy ──────────────────────────────
jobs:
  docs:
    runs-on: ubuntu-latest

    steps:
    # 1) Check out repository
    - name: Checkout repository
      uses: actions/checkout@v3

    # 2) Install Doxygen (and Graphviz if you need call graphs)
    - name: Install Doxygen + Graphviz
      run: |
        sudo apt-get update
        sudo apt-get -y install doxygen graphviz

    # 3) Build documentation
    - name: Generate Doxygen HTML
      run: doxygen Doxyfile         # assumes Doxyfile is at repo root

    # 4) Deploy the docs/html folder to the gh-pages branch
    - name: Deploy to gh-pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        # Built-in token is sufficient for public repos
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_branch: gh-pages
        publish_dir: ./docs/html     # must match OUTPUT_DIRECTORY/html
        # Optional: keep history so older file hashes persist
        keep_files: true
